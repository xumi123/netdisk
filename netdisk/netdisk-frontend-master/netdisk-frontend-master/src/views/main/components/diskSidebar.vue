<template>
  <div class="disk-sidebar-main">
    <div class="disk-sidebar-main-body">
      <div class="disk-sidebar-main-body-item" tabindex="1" @click="contentChange(1)">
        <svg t="1679034327110" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2822" width="36" height="36"><path d="M979.792374 404.577188 574.183101 83.942886c-34.918864-27.694272-89.619352-27.694272-124.538216 0L44.207626 404.577188c-13.933143 11.008903-16.169326 31.134554-5.332437 44.895683s30.618512 16.169326 44.551655 5.332437l12.55703-10.320847 0 387.547791c0 54.872501 57.968755 95.983874 108.712918 95.983874l639.892491 0c50.22812 0 83.254829-38.531161 83.254829-95.983874L927.844112 445.860575l11.69696 8.944734c5.84848 4.644381 13.073072 6.880564 20.125651 6.880564 9.460776 0 18.921552-4.128339 25.286074-12.213002C995.9617 435.711742 993.725517 415.586091 979.792374 404.577188zM479.919368 864.026877 479.919368 686.508315c0-8.77272 15.997312-13.245087 31.994625-13.245087s31.994625 4.472367 31.994625 13.245087l0 177.346548L479.919368 864.026877 479.919368 864.026877zM864.026877 832.032253c0 21.157736-5.84848 31.994625-19.26558 31.994625L608.585923 864.026877c0-0.516042-0.688056-0.860071-0.688056-1.376113L607.897867 686.508315c0-37.155048-29.930455-77.234336-95.983874-77.234336s-95.983874 40.079288-95.983874 77.234336l0 176.142449c0 0.516042 0.860071 0.860071 0.860071 1.376113L204.868806 864.026877c-20.125651 0-44.723669-17.373425-44.723669-31.994625L160.145137 393.740299 488.864102 134.171006c11.868974-9.288762 33.198723-9.288762 44.895683 0l330.095078 261.11742L863.854863 832.032253z" fill="#575B66" p-id="2823"></path></svg>
        <span style="width: 40px;font-size: 14px" >首页</span>
      </div>
      <div class="disk-sidebar-main-body-item" tabindex="1" @click="contentChange(3)">
        <svg t="1679034355753" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3824" width="36" height="36"><path d="M842.7781 825.197188c0 11.227716-9.096169 20.315698-20.315698 20.315698L131.709229 845.512886c-11.219529 0-20.315698-9.087982-20.315698-20.315698L111.393531 337.605088c0-11.200086 9.096169-20.308535 20.315698-20.308535l203.163119 0 0-40.640606L111.393531 276.655947c-22.440082 0-40.633443 18.203594-40.633443 40.640606l0 528.216333c0 22.448268 18.193361 40.631396 40.633443 40.631396L842.7781 886.144282c22.441105 0 40.634466-18.184151 40.634466-40.631396L883.412566 662.665465 842.7781 662.665465 842.7781 825.197188zM950.519963 315.047326 763.765559 128.290875l-28.739555 28.728298 139.974985 139.951449-154.120147 0 0 1.360997C482.572272 312.140113 292.06745 485.590514 275.600407 703.307094l40.652885 0C332.69066 507.940544 505.090125 352.495216 720.880843 338.952782l0-1.347694 154.109913 0L735.026004 477.574956l28.739555 28.728298 186.754405-186.754405-2.25025-2.25332L950.519963 315.047326z" fill="#5D5D5D" p-id="3825"></path></svg>
        <p style="width: 40px;font-size: 14px">收发</p>
      </div>
      <div class="disk-sidebar-main-body-item" tabindex="1" @click="contentChange(4)">
        <el-badge :hidden="!unreadMessageExists" is-dot class="item">
          <svg t="1679320256269" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6051" width="36" height="36"><path d="M882.607224 620.289332c-32.233122-46.50108-75.778894-81.46643-126.399805-101.611236 22.323425-15.70468 41.104163-36.645618 54.679343-61.067844 15.711843-28.26781 24.01802-60.572564 24.01802-93.420693 0-102.397135-79.284741-185.704492-176.739307-185.704492-13.83817 0-25.097608 11.258415-25.097608 25.097608 0 13.855566 11.259438 25.128307 25.097608 25.128307 69.742411 0 126.482693 60.775178 126.482693 135.478578 0 74.719772-56.739259 135.50723-126.482693 135.50723-13.83817 0-25.097608 11.265578-25.097608 25.112957l0 0.1361c0 13.855566 11.259438 25.128307 25.097608 25.128307 125.46348 0 227.536226 108.816335 227.536226 242.568594 0 13.872962 11.285021 25.159006 25.157983 25.159006 13.83817 0 25.097608-11.286044 25.097608-25.159006C935.958316 730.243583 917.509129 670.644183 882.607224 620.289332z" p-id="6052"></path><path d="M623.157147 577.673745c-26.348088-18.662035-55.000662-33.399691-85.316108-43.895743 64.020082-38.906102 103.316064-108.150162 103.316064-183.412286 0-118.333082-96.263437-214.604706-214.588333-214.604706-118.358665 0-214.649731 96.271624-214.649731 214.604706 0 40.289612 11.282974 79.585593 32.630165 113.642247 18.054191 28.803 42.605354 52.879348 71.567989 70.318532-30.826076 10.523681-59.94937 25.424042-86.697571 44.369533-29.125341 20.629853-54.761208 45.569872-76.194356 74.126254-44.566008 59.375296-68.122517 130.018216-68.122517 204.28978 0 13.83817 11.258415 25.097608 25.097608 25.097608 13.855566 0 25.128307-11.259438 25.128307-25.097608 0-77.456093 30.202882-150.434198 85.043908-205.489094 54.711066-54.924937 127.125329-85.206614 203.921389-85.283362 2.535753 0.225127 5.117554 0.047072 7.631818-0.515746l1.991354-0.446162c74.719772 1.51347 144.95337 31.659047 198.329021 85.261872 54.815443 55.04978 85.003999 128.013559 85.003999 205.448162 0 13.83817 11.272741 25.097608 25.128307 25.097608 13.83817 0 25.097608-11.259438 25.097608-25.097608 0-74.271564-23.556509-144.913461-68.121494-204.28978C677.918355 623.243617 652.282488 598.303598 623.157147 577.673745zM426.56877 186.002274c90.629113 0 164.362418 73.733305 164.362418 164.363442 0 90.638323-73.733305 164.378791-164.362418 164.378791-90.647533 0-164.393117-73.740468-164.393117-164.378791C262.17463 259.735579 335.921237 186.002274 426.56877 186.002274z" p-id="6053"></path></svg>
          <p style="width: 40px;font-size: 14px">好友</p>
        </el-badge>
      </div>
    </div>
    <div class="disk-sidebar-main-footer">
      <div class="disk-sidebar-main-footer-placeholder"></div>
    </div>
  </div>
</template>

<script>
import Fileservice from "../../../utils/FileRequest";

export default {
  name: "diskSidebar",
  props: {
    unreadMessageExists: Boolean,
  },
  data(){
    return {
      content: 1,
    }
  },
  created() {
    this.checkMessages()
  },
  mounted() {
    window.addEventListener('onmessageWS', this.getSocketData)
  },
  methods: {
    checkMessages() {
      Fileservice({
        url: 'api/chat/check',
        method:'get',
        params: {
          userId: localStorage.getItem('userId')
        }
      }).then(res=>{
        if (res.data > 0) {
          this.$emit('setUnreadMessageExists',true)
        }
      })
    },
    getSocketData (res) {
      let data = JSON.parse(res.detail.data)
      console.log(data)
      if (data.notifyType === 1) {
        if (this.content !== 4) {
          this.$emit('setUnreadMessageExists',true)
        }
      }
    },
    contentChange(val) {
      this.content = val
      this.$emit('contentChange',val)
      if (val === 4) {
        this.$emit('setUnreadMessageExists',false)
      } else {
        this.$emit('selectedFriendIdChange','')
      }
    }
  }
}
</script>

<style scoped>
.disk-sidebar-main {
  display: inline-flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  z-index: 2;
  box-shadow: 0 3px 10px 0 rgba(0,0,0,.06);
}
.disk-sidebar-main-footer-placeholder {
  height: 80%;
}
.disk-sidebar-main-footer {
  padding-bottom: 40px;
  position: static;
}
.disk-sidebar-main-body-item {
  padding-top: 40px;
  background-color: #fff;
  position: relative;
  z-index: 1;
  border-radius: 10px;
  font-weight: 700;
  color: #636d7e;
  background-color: #fff;
  cursor: pointer;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  flex-shrink: 1;
}
.disk-sidebar-main-body-item :focus
{
  color: #06a7ff;
  background-color: #eef9fe;
}
.disk-sidebar-main-body-item :hover
{
  background-color: #fafafc;
}
</style>
